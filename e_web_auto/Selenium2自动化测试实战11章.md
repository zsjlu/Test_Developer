# 自动化测试项目实战

## 11.1 自动化测试用例设计

对于测试人员来说，不管是进行功能测试、自动化测试还是性能测试都需要编写测试
用例，测试用例的好坏往往能准确地体现测试人员的经验、能力以及对项目需求的
理解深度。所以，在正式开展自动化测试工作之前，我们有必须要聊聊自动化测试用例
的一些特点，以及如何编写自动化测试用例。

### 11.1.1 手工测试用例与自动化测试用例

手工测试用例是针对功能测试人员的，而自动化测试用例则是针对自动化测试框架或工具的；
前者是功能测试用例人员通过手工方式进行用例解析，后者是应用脚本技术进行用例解析。

两者各自最大的特点在于，前者具有较好的异常处理能力，能够基于测试用例，制造各种
不同的逻辑判断，而且人工测试步步跟踪，能够细致地定位问题；

而后者是完全按照测试用例的步骤进行测试，只能在已知的步骤与场景中发现问题，
而且往往因为网络问题或功能的微小变化导致用例执行异常，自动化的执行也很难发现新的bug。

#### 手工测试用例与自动化测试用例对别

1.手工测试用例特点

- 较好的异常处理能力，能通过人为的逻辑判断校验当前步骤的功能是否正确实现
- 人工执行用例具有一定的步骤跳跃性
- 人工测试步步跟踪，能够细致地定位问题
- 主要用来发现功能缺陷

2.自动化测试用例特点

- 执行对象是脚本，任何一个判断都需要编码定义
- 用例步骤之间关联性强
- 主要用来保证产品主题功能正确和完整，让测试人员从烦琐重复的工作中解脱出来
- 目前自动化测试阶段定位在冒烟测试和回归测试

通过对比我们可以看到，手工测试用例与自动化测试用例之间存在较大的差异，所以，
不能直接把手工测试用例“翻译”成自动化测试脚本。

通过它们之间的特点对比也可清晰地认识到，自动化测试不能完全地替代手工测试，
自动化测试的目的仅仅在于让测试人员从烦琐重复的测试过程中解脱出来，把更多的
时间和精力放到更有价值的测试中，例如探索性测试。而自动化测试更多的是用来进行
冒烟测试和回归测试。

3.自动化测试用例选型注意事项：

1）不是所有的手工用例都要转为自动化测试用例。

2）考虑到脚本开发的成本，不要选择流程太复杂的用例。如果有必要，可以考虑把流程拆分
成多个用例来实现脚本。

3）选择的用例最好可以构建成场景。例如，一个功能模块，分多个用例，多个用例使用同一个
场景。这样的好处在于方便构建关键字测试模型。

4）选择的用例可以带有目的性的。例如，这部分用例作冒烟测试，那部分用例作回归测试等，
当然，会存在重叠的关系。如果当前用例不能满足需求，那么唯有修改用例来适应脚本和需求。

5）选取的用例可以是你认为是重复执行，很烦琐的部分。例如，字段验证、提示信息验证这类，
这部分适用于回归测试。

6）选取的用例可以是主体流程，这部分适用于冒烟测试。

7）自动化测试也可以用来做配置检查、数据库检查。这些可能超越了手工用例，但也算用例扩展
的一部分，项目负责人可以有选择地增加。

8）平时在手工测试时，如果需要构造一些复杂的数据或重复一些简单的机械式动作，则告诉自动化
脚本，让它来帮你，或许你的效率会因此而得到提高。


### 11.1.2 测试类型

1.测试静态内容

静态内容测试是最简单的测试，用于验证静态的、不变化的UI元素的存在性。例如：

- 每个页面都有其预期的页面标题吗？这可以用来验证链接指向一个预期的页面。
- 应用程序的主页包含一个应该在页面顶部的图片吗？
- 网站的每一个页面是否都包含一个页脚区域来显示公司的联系方式、隐私政策以及商标信息？
- 每一页的标题文本都使用\<h1>标签吗？每个页面都有正确的头部文本吗？

你看需要（也可能不需要）对页面内容进行自动化测试。如果你的网页内容是不易受到影响，
则手工对内容进行测试就足够了。假设你的应用文件的位置被移动了，则内容测试就非常有
价值。

2.测试链接

Web站点的一个常见错误为失效的链接或链接指向无效页。链接测试涉及各个链接和验证
预期的页面是否存在。如果静态链接不经常更改，则手动测试就足够了。但是，如果你的
网页设计师经常改变链接，或者文件不时被重定向，则链接测试应该实现自动化。

3.功能测试

在你的应用程序中，需要测试应用的特点功能，需要一些类型的用户输入，并返回某种
类型的结果。通常一个功能测试将涉及多个页面，一个基于表单的输入页面，其中包含
若干输入字段、提交和取消操作，以及一个或多个响应页面。用户输入可以通过文本输入域、
复选框、下拉列表，或任何其他浏览器所支持的输入。

功能测试通常是需要自动化测试的最复杂的测试类型，但通常也是最重要的。典型的
测试是登陆、注册网站账户、用户账户操作、账户设置变化、复杂的数据检索操作，等等。
功能测试通常对应着你的应用程序的描述应用特性或设计的使用场景。

4.测试动态元素

通常一个网页元素都有一个唯一的标识符，用于唯一地定位该网页中的元素。通常情况下，
唯一标识符用HTML标记的"id"熟悉或"name"属性来实现。

这些标识符可以是一个静态的（即不变的）字符串常量，也可以是动态生成值，在每
个页面实例上都是变化的。例如，有些Web服务器可能在一个页面实例上命名所显示的
文件为doc3861，而在其他页面实例上显示为doc6148，这取决于用户在检索的“文档”。
验证文件是否存在的测试脚本可能无法找到不变的识别码来定位该文件。通常情况下，具有
变化的标识符的动态元素存在于基于用户操作的结果页面上，然而，显然这取决于Web应用
程序。

5.Ajax的测试

Ajax是一种支持以及动态改变用户界面元素的技术。页面元素可以动态更改，但不需要
浏览器重新载入页面，如动画、RSS源、其他实时数据更新等。Ajax有无数更新网页上
元素的方法。最简单的方式是在Ajax驱动的应用程序中，数据可以从应用服务器检索，
然后显示在页面上，而不需要重新加载整个页面，只有一小部分的页面，或者只有元素
本身被重新加载。

### 11.1.3 自动化测试用例编写原则

在编写自动化测试用例过程中应该遵循以下原则：

1）一个用例为一个完整的场景，从用户登录系统到最终退出并关闭浏览器。

2）一个用例只验证一个功能点，不要试图在用户登录系统后把所有的功能都验证一遍。

3）尽可能少的编写逆向逻辑用例。一方面因为逆向逻辑的用例很多（例如，手机号输错有几十
种情况）；另一方面自动化脚本本身比较脆弱，复杂的逆向逻辑用例实现起来较为麻烦且容易
出错。

4）用例与用例之间尽量避免产生依赖。

5）一条用例完成测试之后需要对测试场景进行还原，以免影响其他用例的执行。


## 11.2 BBS社区项目实战

本节以一个BBS社区项目为例，BBS社区属于互联网比较典型的应用，主要有登陆、个人中心、发帖、
查看帖子、搜索、签到等功能。

### 11.2.1 准备工作

1.项目开发是个循序渐进的过程

需要向读者说明的是，我接下来要介绍的这个自动化测试项目，并非项目最初的形态，
其间经历了多次代码迭代与结构的重构，并且仅仅只是符合当前的项目需求。为什么要强
掉这些呢？

相信我们都知道一个只有几条测试用例的项目和一个几百条测试用例的项目结构肯定是不一样的。
对于只有几条测试用例的项目，我不需要考虑太多结构方面的问题，甚至只用线性模型来编写用例，
其维护成本也不会太高；但是，当用例达到几百条时就不得不考虑各种问题，例如，如何降低测试
代码的冗余、对代码进行抽象与分层、采用哪种设计模式，等等。

自动化测试的开发，是个不断调整代码与结构的过程，也许第一天你编写了二十条用例，到第二天
的时候，你需要花三分之一的时间对昨天的部分代码进行调整或重构。只有三分之二的时间用于编写
新的用例。类、方法和函数的命名也是需要考究的方面，既要尽量保持简洁，又要见名知义。代码的
编写更是如此，如何写出简洁优雅的代码时对我们编程功底的考验。遗憾的是无法带着读者去复盘这样
一个过程。其实，这个过程也必须由读者自己在不断实践中积累和总结。

2.选择合适的IDE

工欲善其事，必先利其器，在开始开发自动化项目之前，我们有必要先来聊一聊Python有哪些IDE。
前面章节中的例子默认以Python自带的IDLE运行，但这只推荐于Python语言的初学者，在真正利用
Python开发项目时它就显得比较鸡肋了。当然，关于IDE的讨论一直属于热门话题，这里并不是要分辨
个孰优孰劣，这里只是想告诉读者不同的编程阶段应选择适合自己的IDE。

Python IDLE：如果读者初学Python，并且不精通其他编程语言及IDE，则建议从这个IDE入手，它自带
的Shell模式可以帮助我们快速练习Python语法，笔者初学Python时用了半年。

UliPad：轻量级的Python IDE，由国内用户基于wxPython开发，代码着色及自动补全功能很不错，
配置也相对比较简单。

Sublime：通用型轻量级IDE，支持多种编程语言。有许多功能强大的快捷键（如Ctrl+d），如果
平时需要在多种编程语言间切换，那么这将是不错的选择。这也是笔者最常用的IDE之一。

PyCharm：Python重量级IDE，功能强大，自动检测语法，可以帮助我们写出更规范的Python代码。
对于处女座的开发者来说是个不错的选择。笔者试用半天后果断拥抱之。

Eclipse+pydev: Eclipse也属于重量级IDE。相信学习Java语言的同学一般都会选择此IDE，配置
pydev插件后同样可以用来编写Python程序，对于熟悉Eclipse的同学是个不错的选择。

Vim与Emacs：一直是程序员大神口中的神器，学习成本很高。

### 11.2.2 项目结构介绍

略   


